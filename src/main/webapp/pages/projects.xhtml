<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
<h:head>
    <title>Gestor de Proyectos</title>
</h:head>
<h:body>
    <h:form id="formProjects">
        <p:growl id="msgs" showDetail="true" globalOnly="true"/>
        <h:form id="formProjects">
            ...
        </h:form>

        <p:commandButton value="Nuevo Proyecto"
                         actionListener="#{projectController.newProject}"
                         oncomplete="PF('dlgProject').show()" update=":formProjectDlg" />

        <p:dataTable value="#{projectController.projects}" var="p" rowKey="#{p.id}">
            <p:column headerText="Nombre">#{p.name}</p:column>
            <p:column headerText="Owner">#{p.owner}</p:column>
            <p:column headerText="Estado">#{p.status}</p:column>
            <p:column>
                <p:commandButton value="Editar"
                                 actionListener="#{projectController.setSelected(p)}"
                                 oncomplete="PF('dlgProject').show()" update=":formProjectDlg" />
                <p:commandButton value="Eliminar"
                                 actionListener="#{projectController.delete(p)}"
                                 update="@form" />
                <p:commandButton value="Ver Tareas"
                                 actionListener="#{taskController.loadTasks(p.id)}"
                                 oncomplete="PF('dlgTasks').show()" update=":formTasksDlg" />
            </p:column>
        </p:dataTable>
    </h:form>

    <!-- Dialogo Proyecto -->
    <p:dialog widgetVar="dlgProject" modal="true">
        <h:form id="formProjectDlg">
            <h:panelGrid columns="2">
                <h:outputLabel for="name" value="Nombre"/>
                <p:inputText id="name" value="#{projectController.selected.name}" required="true" />

                <h:outputLabel for="owner" value="Owner"/>
                <p:inputText id="owner" value="#{projectController.selected.owner}" required="true" />

                <h:outputLabel for="status" value="Estado"/>
                <p:selectOneMenu id="status" value="#{projectController.selected.status}">
                    <f:selectItems value="#{Project.Status.values()}" var="s" itemLabel="#{s}" itemValue="#{s}" />
                </p:selectOneMenu>

                <h:outputLabel for="desc" value="DescripciÃ³n"/>
                <p:inputTextarea id="desc" value="#{projectController.selected.description}" />
            </h:panelGrid>
            <p:commandButton value="Guardar"
                             actionListener="#{projectController.save}"
                             update=":formProjects :formProjects:msgs"
                             oncomplete="PF('dlgProject').hide()" />
        </h:form>
    </p:dialog>

    <!-- Dialogo Tareas -->
    <p:dialog widgetVar="dlgTasks" modal="true" header="Tareas del Proyecto">
        <ui:include src="/pages/fragments/tasks-by-project.xhtml"/>
    </p:dialog>
</h:body>
</html>